---
layout: post
title: mondrian heading for 4.0
date: '2010-07-23T17:45:00.000-07:00'
author: Julian Hyde
tags:
- mondrian 4.0 xml schema unit test
modified_time: '2010-07-23T20:27:43.132-07:00'
blogger_id: tag:blogger.com,1999:blog-5672165237896126100.post-1308386280460423815
blogger_orig_url: https://julianhyde.blogspot.com/2010/07/mondrian-heading-for-40.html
---

I am currently working on mondrian-4.0 and am reworking a lot of mondrian's internals, particularly in how schemas are loaded and validated, and in the mapping of levels and measures onto star schemas. Regression tests for bugs and features are always important, but they are especially important right now.<br /><br /><h3>Regression tests, now more than ever</h3>Usually when I am changing mondrian, if I see a piece of logic in the code, I will try to preserve that logic, and will rework it if necessary when internal APIs change. That goes for other committers too. But I don't propose to do that for mondrian-4.0: the changes to the code are quite widespread, and besides, it's chance to clean out some of the cruft that has built up over the years.<br /><br />Yes, it's true. Even in mondrian's impeccably clean code &mdash; almost 300,000 lines of it &mdash; there are some pieces of code that we're not sure are actually used. My natural inclination as a developer is to remove that code, and see whether anything breaks. If that piece of code is a something you contributed but didn't write a test for, then nothing will break, and your code will be on the cutting room floor of history.<br /><br />So, if you have contributed a feature or bug fix to mondrian over the past years or months, make sure that there is a test case checked in as part of mondrian's regression test suite. I will do my best to make sure that the test case stays working, even if the code underneath is all different. <b>If there isn't a test, your beloved feature may just disappear in mondrian-4.0</b>.<br /><br /><h3>Schema changes, and compatibility</h3>In mondrian-4.0 there will be changes to how schemas are structured. A few examples:<ul><li>Virtual cubes will be obsolete, or more precisely, any cube can have multiple groups of measures, each group based on a separate fact table.</li><li>Linkages between snowflake tables, currently specified using the <join> element, will be specified using new &lt;PhysicalSchema&gt; element that declares table usages, relationships, and derived columns for the whole schema.</li><li>The present XML grammar isn't very forgiving if you get things in the wrong order: if you define a &lt;NamedSet&gt; before your &lt;CalculatedMember&gt;s in a cube, mondrian currently ignores all calculated members. The new XML grammar will be more forgiving.</li></ul>I recently decided that the XML grammar is sufficiently different that I would create a new XML grammar. But <a href="http://wiki.pentaho.com/display/analysis/Physical+Schema+Design+Discussion">I promised</a> that mondrian would be backwards compatible, and I will stand by that. There will be a converter that will recognize an old-style schema, convert it to a new-style schema in memory, and then proceed to load the new-style schema. So, old-style schemas should continue to work. Mondrian-4.0<br /><br />In a few weeks I will be ready to release the specification for the new-style schemas. I would appreciate review of the new schemas. Since it is a major change, mondrian-4.0 will have a long beta phase. During which time I could use your help testing both new features and backwards compatibility.