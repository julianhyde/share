---
layout: post
title: An experiment with the Linux scheduler
date: '2010-12-19T21:26:00.000-08:00'
author: Julian Hyde
tags:
- linux thread scheduler
modified_time: '2010-12-19T21:26:17.786-08:00'
thumbnail: http://4.bp.blogspot.com/_BVv0WTpeWTs/TQ7ngj1xKVI/AAAAAAAAAEw/dphV-tXC2hM/s72-c/chart
blogger_id: tag:blogger.com,1999:blog-5672165237896126100.post-1037821703076693964
blogger_orig_url: https://julianhyde.blogspot.com/2010/12/experiment-with-linux-scheduler.html
---

I was curious to see how the Linux scheduler would manifest from a program's perspective, so today I did an experiment.<br /><br />I wrote a single-threaded program running a simple loop. All the loop does is to compute the number of milliseconds since the last iteration, and store the result in a histogram. We are not so much interested in the performance of the loop (it does about a million iterations per second) but in the variations in the intervals between loop iterations. These variations are presumably caused by the Linux scheduler.<br /><br />Here are the numbers I achieved, and the same numbers in a chart (with a logarithmic y-axis).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_BVv0WTpeWTs/TQ7ngj1xKVI/AAAAAAAAAEw/dphV-tXC2hM/s1600/chart" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="172" src="http://4.bp.blogspot.com/_BVv0WTpeWTs/TQ7ngj1xKVI/AAAAAAAAAEw/dphV-tXC2hM/s320/chart" width="320" /></a></div><br /><div><table><tbody><tr><th>Interval (milliseconds)</th><th>Frequency</th></tr><tr><td>0</td>    <td align="right">450,080,302</td></tr><tr><td>1</td>    <td align="right">909,044</td></tr><tr><td>2</td>    <td align="right">4,642</td></tr><tr><td>3</td>    <td align="right">1,696</td></tr><tr><td>4</td>    <td align="right">853</td></tr><tr><td>5</td>    <td align="right">561</td></tr><tr><td>6</td>    <td align="right">557</td></tr><tr><td>7</td>    <td align="right">335</td></tr><tr><td>8</td>    <td align="right">1,098</td></tr><tr><td>9</td>    <td align="right">152</td></tr><tr><td>10</td>    <td align="right">86</td></tr><tr><td>11</td>    <td align="right">52</td></tr><tr><td>12</td>    <td align="right">98</td></tr><tr><td>13</td>    <td align="right">17</td></tr><tr><td>14</td>    <td align="right">13</td></tr><tr><td>15</td>    <td align="right">6</td></tr><tr><td>16</td>    <td align="right">21</td></tr><tr><td>17</td>    <td align="right">5</td></tr><tr><td>19</td>    <td align="right">3</td></tr><tr><td>20</td>    <td align="right">1</td></tr><tr><td>21</td>    <td align="right">2</td></tr><tr><td>22</td>    <td align="right">2</td></tr><tr><td>23</td>    <td align="right">0</td></tr><tr><td>24</td>    <td align="right">2</td></tr><tr><td>25</td>    <td align="right">0</td></tr><tr><td>26</td>    <td align="right">0</td></tr><tr><td>27</td>    <td align="right">0</td></tr><tr><td>28</td>    <td align="right">1</td></tr><tr><td>29</td>    <td align="right">0</td></tr></tbody> </table></div><br />The vast majority of iterations occur zero milliseconds after the previous iteration. No surprise there; Java's clock granularity, 1 millisecond, is coarse enough to execute over a million instructions.<br /><br />If the thread was never interrupted, one would expect the loop to tick forward 1 millisecond 1,000 times per second, or about 500,000 times in all. It actually ticks 909,044 times, so interrupts are at work: about 400,000 of them.<br /><br />Longer delays also occur: 2, 3, 4, up to 28 milliseconds, occurring with exponentially decreasing frequency. Only 8 delays of 20 milliseconds or longer occur in the 7.5 minute run. The chart shows the exponential decay clearly. The chart plots log-frequency, and the trend line is indeed flat from 2 milliseconds onwards, so it is accurate to characterize the line as exponential.<br /><br />The one surprising thing: significant bumps at 8, 12 and 16 milliseconds. Although the trend of the line is pretty consistently down, each of those interval durations has more distinctly occurrences than the previous interval. Does anyone know anything about the Linux scheduler that might explain this?